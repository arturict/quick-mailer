import{c as e,r as s,s as a,j as l,m as t,A as i}from"./index-Cqz6aFLN.js";import{e as n}from"./api-CmDAT7Uc.js";import{T as c,E as r,a as d}from"./EmptyState-DDFaV-9A.js";import"./react-vendor-Bs9WG82D.js";const m=e("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),o=e("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),x=e("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),h=e("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),p=s.memo(function({email:e,onView:s,formatDate:a,getStatusBadge:i,index:n}){return l.jsxs(t.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.05*n},className:"hover:bg-base-200 transition-colors",children:[l.jsx("td",{className:"hidden sm:table-cell font-mono text-sm",children:e.id}),l.jsx("td",{className:"hidden md:table-cell truncate max-w-[150px] lg:max-w-xs",title:e.from_address,children:e.from_address}),l.jsx("td",{className:"truncate max-w-[120px] sm:max-w-[200px] lg:max-w-xs",title:e.to_address,children:e.to_address}),l.jsx("td",{className:"hidden lg:table-cell truncate max-w-xs font-medium",title:e.subject,children:e.subject}),l.jsx("td",{children:l.jsx("span",{className:`badge badge-sm ${i(e.status)}`,children:e.status})}),l.jsx("td",{className:"hidden md:table-cell text-sm opacity-70",children:a(e.created_at)}),l.jsx("td",{children:l.jsxs(t.button,{className:"btn btn-xs btn-ghost gap-1",onClick:()=>s(e),whileHover:{scale:1.1},whileTap:{scale:.9},"aria-label":`View email ${e.id}`,children:[l.jsx(d,{className:"w-3 h-3"}),l.jsx("span",{className:"hidden sm:inline",children:"View"})]})})]},e.id)});function j(){const[e,d]=s.useState([]),[j,u]=s.useState(null),[b,N]=s.useState(1),[g,v]=s.useState(1),[y,f]=s.useState(!1),[w,k]=s.useState({}),[C,S]=s.useState(""),[_,T]=s.useState(""),[E,D]=s.useState(""),[F,M]=s.useState(""),[H,P]=s.useState(""),[L,A]=s.useState(""),I=s.useCallback(()=>{return e=null,s=null,l=function*(){f(!0);try{const e=yield n.getEmails(b,50,w);d(e.emails),v(e.totalPages)}catch(e){a.error("Failed to load email history")}finally{f(!1)}},new Promise((a,t)=>{var i=e=>{try{c(l.next(e))}catch(s){t(s)}},n=e=>{try{c(l.throw(e))}catch(s){t(s)}},c=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);c((l=l.apply(e,s)).next())});var e,s,l},[b]);s.useEffect(()=>{const e=setTimeout(()=>{const e={};C.trim()&&(e.recipient=C.trim()),_.trim()&&(e.subject=_.trim()),E.trim()&&(e.sender=E.trim()),F&&(e.status=F),H&&(e.dateFrom=H),L&&(e.dateTo=L),k(e),N(1)},300);return()=>clearTimeout(e)},[C,_,E,F,H,L]),s.useEffect(()=>{I()},[I]);const V=s.useCallback(()=>{S(""),T(""),D(""),M(""),P(""),A(""),k({}),N(1)},[]),R=s.useCallback(e=>{if(!e)return"N/A";const s=new Date(e);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)},[]),$=s.useCallback(e=>({sent:"badge-success",failed:"badge-error",pending:"badge-warning"}[e]||"badge-ghost"),[]),q=s.useCallback(()=>{N(e=>Math.max(1,e-1))},[]),z=s.useCallback(()=>{N(e=>Math.min(g,e+1))},[g]);return l.jsxs("div",{className:"space-y-4",children:[l.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card bg-base-100 shadow-xl",children:l.jsxs("div",{className:"card-body",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h2",{className:"card-title flex items-center gap-2",children:"ðŸ“¬ Email History"}),l.jsxs(t.button,{className:"btn btn-sm btn-ghost gap-2",onClick:I,disabled:y,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Refresh email history",children:[l.jsx(x,{className:"w-4 h-4 "+(y?"animate-spin":"")}),"Refresh"]})]}),l.jsxs("div",{className:"bg-base-200 rounded-lg p-4 space-y-3 mb-4",children:[l.jsxs("div",{className:"flex flex-wrap gap-3",children:[l.jsxs("div",{className:"form-control flex-1 min-w-[200px]",children:[l.jsx("label",{className:"label py-1",children:l.jsx("span",{className:"label-text text-xs",children:"Search Recipient"})}),l.jsx("input",{type:"text",placeholder:"Email address...",className:"input input-sm input-bordered",value:C,onChange:e=>S(e.target.value)})]}),l.jsxs("div",{className:"form-control flex-1 min-w-[200px]",children:[l.jsx("label",{className:"label py-1",children:l.jsx("span",{className:"label-text text-xs",children:"Search Subject"})}),l.jsx("input",{type:"text",placeholder:"Subject keywords...",className:"input input-sm input-bordered",value:_,onChange:e=>T(e.target.value)})]}),l.jsxs("div",{className:"form-control flex-1 min-w-[200px]",children:[l.jsx("label",{className:"label py-1",children:l.jsx("span",{className:"label-text text-xs",children:"Search Sender"})}),l.jsx("input",{type:"text",placeholder:"From address...",className:"input input-sm input-bordered",value:E,onChange:e=>D(e.target.value)})]}),l.jsxs("div",{className:"form-control min-w-[150px]",children:[l.jsx("label",{className:"label py-1",children:l.jsx("span",{className:"label-text text-xs",children:"Status"})}),l.jsxs("select",{className:"select select-sm select-bordered",value:F,onChange:e=>M(e.target.value),children:[l.jsx("option",{value:"",children:"All"}),l.jsx("option",{value:"sent",children:"Sent"}),l.jsx("option",{value:"failed",children:"Failed"}),l.jsx("option",{value:"pending",children:"Pending"})]})]})]}),l.jsxs("div",{className:"flex flex-wrap gap-3 items-end",children:[l.jsxs("div",{className:"form-control min-w-[180px]",children:[l.jsx("label",{className:"label py-1",children:l.jsx("span",{className:"label-text text-xs",children:"Date From"})}),l.jsx("input",{type:"datetime-local",className:"input input-sm input-bordered",value:H,onChange:e=>P(e.target.value)})]}),l.jsxs("div",{className:"form-control min-w-[180px]",children:[l.jsx("label",{className:"label py-1",children:l.jsx("span",{className:"label-text text-xs",children:"Date To"})}),l.jsx("input",{type:"datetime-local",className:"input input-sm input-bordered",value:L,onChange:e=>A(e.target.value)})]}),l.jsx("button",{className:"btn btn-sm btn-ghost",onClick:V,disabled:!(C||_||E||F||H||L),children:"ðŸ—‘ï¸ Clear Filters"})]})]}),y&&0===e.length?l.jsx(c,{rows:5}):0===e.length?Object.keys(w).length>0?l.jsx(r,{icon:"sparkles",title:"No results found",description:"Try adjusting your search filters to find what you're looking for.",action:{label:"Clear Filters",onClick:V}}):l.jsx(r,{icon:"inbox",title:"No emails sent yet",description:"Your email history will appear here once you send your first email.",action:{label:"Compose Email",onClick:()=>window.dispatchEvent(new CustomEvent("navigate",{detail:"compose"}))}}):l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"overflow-x-auto relative",children:[y&&e.length>0&&l.jsx("div",{className:"absolute inset-0 bg-base-100/50 flex items-center justify-center z-10",children:l.jsx("span",{className:"loading loading-spinner loading-md"})}),l.jsxs("table",{className:"table table-zebra",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{className:"hidden sm:table-cell w-16",children:"ID"}),l.jsx("th",{className:"hidden md:table-cell",children:"From"}),l.jsx("th",{children:"To"}),l.jsx("th",{className:"hidden lg:table-cell",children:"Subject"}),l.jsx("th",{className:"w-20 sm:w-24",children:"Status"}),l.jsx("th",{className:"hidden md:table-cell",children:"Date"}),l.jsx("th",{className:"w-16 sm:w-24",children:"Actions"})]})}),l.jsx("tbody",{children:l.jsx(i,{mode:"popLayout",children:e.map((e,s)=>l.jsx(p,{email:e,onView:u,formatDate:R,getStatusBadge:$,index:s},e.id))})})]})]}),g>1&&l.jsxs(t.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center items-center gap-2 mt-4",children:[l.jsxs(t.button,{className:"btn btn-sm gap-1 sm:gap-2",onClick:q,disabled:1===b,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Previous page",children:[l.jsx(m,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Previous"})]}),l.jsxs("span",{className:"btn btn-sm btn-ghost pointer-events-none text-xs sm:text-sm",children:[l.jsx("span",{className:"hidden sm:inline",children:"Page "}),b,l.jsxs("span",{className:"hidden sm:inline",children:[" of ",g]}),l.jsxs("span",{className:"sm:hidden",children:["/",g]})]}),l.jsxs(t.button,{className:"btn btn-sm gap-1 sm:gap-2",onClick:z,disabled:b===g,whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Next page",children:[l.jsx("span",{className:"hidden sm:inline",children:"Next"}),l.jsx(o,{className:"w-4 h-4"})]})]})]})]})}),l.jsx(i,{children:j&&l.jsxs("dialog",{className:"modal modal-open",children:[l.jsxs(t.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"modal-box max-w-3xl",children:[l.jsxs("div",{className:"flex justify-between items-start mb-4",children:[l.jsx("h3",{className:"font-bold text-lg",children:"Email Details"}),l.jsx("button",{className:"btn btn-sm btn-circle btn-ghost",onClick:()=>u(null),"aria-label":"Close modal",children:l.jsx(h,{className:"w-4 h-4"})})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"From:"}),l.jsx("p",{className:"break-all",children:j.from_address})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"To:"}),l.jsx("p",{className:"break-all",children:j.to_address})]})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"Subject:"}),l.jsx("p",{className:"font-medium",children:j.subject})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"Status:"}),l.jsx("div",{className:"mt-1",children:l.jsx("span",{className:`badge ${$(j.status)}`,children:j.status})})]}),l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"Date:"}),l.jsx("p",{children:R(j.created_at)})]})]}),j.email_id&&l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"Email ID:"}),l.jsx("p",{className:"font-mono text-sm break-all",children:j.email_id})]}),j.error_message&&l.jsxs("div",{className:"alert alert-error",children:[l.jsx("strong",{children:"Error:"})," ",j.error_message]}),l.jsx("div",{className:"divider",children:"Message Content"}),j.body_html?l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"HTML Content:"}),l.jsx("div",{className:"bg-base-200 p-4 rounded mt-2 overflow-auto max-h-96",dangerouslySetInnerHTML:{__html:j.body_html}})]}):j.body_text?l.jsxs("div",{children:[l.jsx("strong",{className:"text-sm opacity-70",children:"Text Content:"}),l.jsx("pre",{className:"bg-base-200 p-4 rounded mt-2 overflow-auto max-h-96 whitespace-pre-wrap",children:j.body_text})]}):l.jsx("div",{className:"text-base-content/50 text-center py-4",children:"No content"})]}),l.jsx("div",{className:"modal-action",children:l.jsx("button",{className:"btn",onClick:()=>u(null),children:"Close"})})]}),l.jsx("form",{method:"dialog",className:"modal-backdrop bg-black/50",children:l.jsx("button",{onClick:()=>u(null),children:"close"})})]})})]})}export{j as EmailHistory};
