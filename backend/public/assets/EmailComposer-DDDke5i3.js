var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&n(e,l,a[l]);if(t)for(var l of t(a))i.call(a,l)&&n(e,l,a[l]);return e},c=(e,t)=>a(e,l(t));import{c as o,r as m,s as d,u as p,j as u,m as x,M as h,F as b}from"./index-Cqz6aFLN.js";import{t as f,e as j}from"./api-CmDAT7Uc.js";import"./react-vendor-Bs9WG82D.js";const y=o("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),g=o("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function v({onEmailSent:e}){const[a,l]=m.useState([]),[t,s]=m.useState([]),[i,n]=m.useState(null),[o,v]=m.useState({from:"",to:"",subject:"",text:"",html:""}),[N,w]=m.useState({}),[k,S]=m.useState(!1),[E,C]=m.useState(!1),O=m.useRef(null);m.useEffect(()=>{const e="noreply@example.com".split(",");l(e),e.length>0&&v(a=>c(r({},a),{from:e[0]})),f.getTemplates().then(e=>{s(e.templates)}).catch(e=>{d.error("Failed to load templates")})},[]),p([{key:"Enter",ctrl:!0,callback:()=>{O.current&&!E&&O.current.requestSubmit()},description:"Send email"}]);const T=m.useCallback(a=>{return l=null,t=null,s=function*(){a.preventDefault(),C(!0);try{const a=i?{from:o.from,to:o.to,subject:"",templateId:i.id,variables:N}:o,l=yield j.sendEmail(a);d.success(`Email sent successfully! ID: ${l.id}`),v({from:o.from,to:"",subject:"",text:"",html:""}),n(null),w({}),null==e||e()}catch(l){d.error(l instanceof Error?l.message:"Failed to send email")}finally{C(!1)}},new Promise((e,i)=>{var n=e=>{try{c(s.next(e))}catch(a){i(a)}},r=e=>{try{c(s.throw(e))}catch(a){i(a)}},c=a=>a.done?e(a.value):Promise.resolve(a.value).then(n,r);c((s=s.apply(l,t)).next())});var l,t,s},[i,o,N,e]),M=m.useCallback(e=>{var a;if(!e)return n(null),void w({});const l=t.find(a=>a.id===parseInt(e));if(l){n(l);const e={};null==(a=l.variables)||a.forEach(a=>{e[a]=""}),w(e),S(!!l.body_html)}},[t]),P=m.useCallback((e,a)=>{v(l=>c(r({},l),{[e]:a}))},[]),F=m.useCallback((e,a)=>{w(l=>c(r({},l),{[e]:a}))},[]);return u.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card bg-base-100 shadow-xl",children:u.jsxs("div",{className:"card-body",children:[u.jsxs("h2",{className:"card-title flex items-center gap-2",children:[u.jsx(h,{className:"w-6 h-6"}),"Compose Email"]}),u.jsxs("form",{ref:O,onSubmit:T,className:"space-y-4",children:[u.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"form-control",children:[u.jsx("label",{className:"label",children:u.jsxs("span",{className:"label-text flex items-center gap-2",children:[u.jsx(g,{className:"w-4 h-4"}),"From"]})}),u.jsx("select",{className:"select select-bordered w-full focus:outline-offset-0 transition-all",value:o.from,onChange:e=>P("from",e.target.value),required:!0,"aria-label":"Select from address",children:a.map(e=>u.jsx("option",{value:e,children:e},e))})]}),u.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.15},className:"form-control",children:[u.jsx("label",{className:"label",children:u.jsxs("span",{className:"label-text flex items-center gap-2",children:[u.jsx(h,{className:"w-4 h-4"}),"To"]})}),u.jsx("input",{type:"email",className:"input input-bordered w-full focus:outline-offset-0 transition-all",placeholder:"recipient@example.com",value:o.to,onChange:e=>P("to",e.target.value),required:!0,"aria-label":"Recipient email address"})]}),t.length>0&&u.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"form-control",children:[u.jsx("label",{className:"label",children:u.jsxs("span",{className:"label-text flex items-center gap-2",children:[u.jsx(b,{className:"w-4 h-4"}),"Use Template (Optional)"]})}),u.jsxs("select",{className:"select select-bordered w-full focus:outline-offset-0 transition-all",value:(null==i?void 0:i.id)||"",onChange:e=>M(e.target.value),"aria-label":"Select email template",children:[u.jsx("option",{value:"",children:"-- Custom Email --"}),t.map(e=>u.jsx("option",{value:e.id,children:e.name},e.id))]})]}),i&&i.variables&&i.variables.length>0&&u.jsxs(x.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"space-y-2",children:[u.jsx("label",{className:"label",children:u.jsx("span",{className:"label-text font-medium",children:"Template Variables"})}),i.variables.map((e,a)=>u.jsx(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*a},className:"form-control",children:u.jsxs("div",{className:"input-group",children:[u.jsx("span",{className:"bg-base-300 px-4 flex items-center min-w-[120px] font-medium",children:e}),u.jsx("input",{type:"text",className:"input input-bordered flex-1 focus:outline-offset-0",placeholder:`Enter ${e}...`,value:N[e]||"",onChange:a=>F(e,a.target.value),required:!0,"aria-label":`Template variable ${e}`})]})},e))]}),!i&&u.jsxs(u.Fragment,{children:[u.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.25},className:"form-control",children:[u.jsx("label",{className:"label",children:u.jsx("span",{className:"label-text",children:"Subject"})}),u.jsx("input",{type:"text",className:"input input-bordered w-full focus:outline-offset-0 transition-all",placeholder:"Email subject",value:o.subject,onChange:e=>P("subject",e.target.value),required:!0,"aria-label":"Email subject"})]}),u.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"form-control",children:[u.jsxs("label",{className:"label",children:[u.jsx("span",{className:"label-text",children:"Message"}),u.jsx("div",{className:"form-control",children:u.jsxs("label",{className:"label cursor-pointer gap-2",children:[u.jsx("span",{className:"label-text text-sm",children:"HTML Mode"}),u.jsx("input",{type:"checkbox",className:"toggle toggle-primary toggle-sm",checked:k,onChange:e=>S(e.target.checked),"aria-label":"Toggle HTML mode"})]})})]}),u.jsx("textarea",{className:"textarea textarea-bordered h-40 focus:outline-offset-0 transition-all font-mono text-sm",placeholder:k?"<p>HTML content</p>":"Plain text message",value:k?o.html:o.text,onChange:e=>P(k?"html":"text",e.target.value),required:!0,"aria-label":"Email message content"})]})]}),u.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.35},className:"card-actions justify-end pt-4",children:u.jsx(x.button,{type:"submit",className:"btn btn-primary gap-2",disabled:E,whileHover:{scale:1.02},whileTap:{scale:.98},children:E?u.jsxs(u.Fragment,{children:[u.jsx("span",{className:"loading loading-spinner loading-sm"}),"Sending..."]}):u.jsxs(u.Fragment,{children:[u.jsx(y,{className:"w-4 h-4"}),"Send Email",u.jsx("kbd",{className:"kbd kbd-sm ml-2 hidden md:inline-flex",children:"Ctrl+â†µ"})]})})})]})]})})}export{v as EmailComposer};
