var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,c=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&n(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&n(e,t,a[t]);return e},r=(e,l)=>a(e,t(l)),o=(e,a,t)=>new Promise((l,s)=>{var i=e=>{try{c(t.next(e))}catch(a){s(a)}},n=e=>{try{c(t.throw(e))}catch(a){s(a)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,n);c((t=t.apply(e,a)).next())});import{c as d,r as m,j as h,m as p,I as x,s as u,F as b,A as j}from"./index-Cqz6aFLN.js";import{t as y}from"./api-CmDAT7Uc.js";import{a as f,T as v,E as N}from"./EmptyState-DDFaV-9A.js";import"./react-vendor-Bs9WG82D.js";const g=d("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),w=d("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),k=d("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),T=d("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),C=d("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);function E({template:e,onClose:a}){const[t,l]=m.useState({name:(null==e?void 0:e.name)||"",subject:(null==e?void 0:e.subject)||"",text:(null==e?void 0:e.body_text)||"",html:(null==e?void 0:e.body_html)||""}),[s,i]=m.useState(!!(null==e?void 0:e.body_html)),[n,d]=m.useState(!1),[b,j]=m.useState({}),v=function(e){const a=e.matchAll(/\{\{(\w+)\}\}/g),t=new Set;for(const l of a)t.add(l[1]);return Array.from(t)}(`${t.subject} ${s?t.html:t.text}`);m.useEffect(()=>{const e={};v.forEach(a=>{e[a]=""}),j(e)},[v.join(",")]);const N=(e,a)=>e.replace(/\{\{(\w+)\}\}/g,(e,t)=>a[t]||e);return h.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card bg-base-100 shadow-xl",children:h.jsxs("div",{className:"card-body",children:[h.jsxs("div",{className:"flex justify-between items-center mb-4",children:[h.jsx("h2",{className:"card-title flex items-center gap-2",children:e?h.jsxs(h.Fragment,{children:[h.jsx(T,{className:"w-6 h-6"}),"Edit Template"]}):h.jsxs(h.Fragment,{children:[h.jsx(T,{className:"w-6 h-6"}),"Create Template"]})}),h.jsxs(p.button,{onClick:a,className:"btn btn-ghost btn-sm gap-2",whileHover:{scale:1.05},whileTap:{scale:.95},children:[h.jsx(g,{className:"w-4 h-4"}),"Back"]})]}),h.jsxs("form",{onSubmit:l=>o(null,null,function*(){l.preventDefault(),d(!0);try{const l={name:t.name,subject:t.subject,text:t.text||void 0,html:t.html||void 0,variables:v};(null==e?void 0:e.id)?(yield y.updateTemplate(e.id,l),u.success(`Template "${t.name}" updated successfully`)):(yield y.createTemplate(l),u.success(`Template "${t.name}" created successfully`)),a()}catch(s){u.error(s instanceof Error?s.message:"Failed to save template")}finally{d(!1)}}),className:"space-y-4",children:[h.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"form-control",children:[h.jsx("label",{className:"label",children:h.jsx("span",{className:"label-text font-medium",children:"Template Name"})}),h.jsx("input",{type:"text",className:"input input-bordered w-full focus:outline-offset-0 transition-all",placeholder:"e.g., Welcome Email",value:t.name,onChange:e=>l(r(c({},t),{name:e.target.value})),required:!0,"aria-label":"Template name"})]}),h.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.15},className:"form-control",children:[h.jsxs("label",{className:"label",children:[h.jsx("span",{className:"label-text font-medium",children:"Subject"}),h.jsxs("span",{className:"label-text-alt text-xs opacity-60",children:["Use ","{{variable}}"," for dynamic content"]})]}),h.jsx("input",{type:"text",className:"input input-bordered w-full focus:outline-offset-0 transition-all",placeholder:"e.g., Welcome {{name}}!",value:t.subject,onChange:e=>l(r(c({},t),{subject:e.target.value})),required:!0,"aria-label":"Email subject"})]}),h.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"form-control",children:[h.jsxs("label",{className:"label",children:[h.jsx("span",{className:"label-text font-medium",children:"Message"}),h.jsx("div",{className:"form-control",children:h.jsxs("label",{className:"label cursor-pointer gap-2",children:[h.jsx("span",{className:"label-text text-sm",children:"HTML Mode"}),h.jsx("input",{type:"checkbox",className:"toggle toggle-primary toggle-sm",checked:s,onChange:e=>i(e.target.checked),"aria-label":"Toggle HTML mode"})]})})]}),h.jsx("textarea",{className:"textarea textarea-bordered h-40 focus:outline-offset-0 transition-all font-mono text-sm",placeholder:s?"<h1>Hello {{name}}</h1><p>Welcome!</p>":"Hello {{name}}, welcome to our service!",value:s?t.html:t.text,onChange:e=>l(r(c({},t),{[s?"html":"text"]:e.target.value})),required:!0,"aria-label":"Email message content"})]}),v.length>0&&h.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"alert alert-info",children:[h.jsx(x,{className:"w-5 h-5 flex-shrink-0"}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h3",{className:"font-bold",children:"Detected Variables:"}),h.jsx("div",{className:"flex gap-2 flex-wrap mt-1",children:v.map(e=>h.jsx("span",{className:"badge badge-lg",children:e},e))})]})]}),h.jsxs("div",{className:"divider",children:[h.jsx(f,{className:"w-4 h-4 inline mr-2"}),"Preview"]}),v.length>0&&h.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.25},className:"space-y-2",children:[h.jsx("label",{className:"label",children:h.jsx("span",{className:"label-text font-medium",children:"Fill variables to preview:"})}),v.map((e,a)=>h.jsx(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*a},className:"form-control",children:h.jsxs("div",{className:"input-group",children:[h.jsx("span",{className:"bg-base-300 px-4 flex items-center min-w-[120px] font-medium",children:e}),h.jsx("input",{type:"text",className:"input input-bordered flex-1",placeholder:`Enter ${e}...`,value:b[e]||"",onChange:a=>j(r(c({},b),{[e]:a.target.value})),"aria-label":`Preview value for ${e}`})]})},e))]}),h.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"card bg-base-200",children:h.jsxs("div",{className:"card-body",children:[h.jsx("h3",{className:"font-bold text-sm opacity-70",children:"Subject Preview:"}),h.jsx("p",{className:"text-lg",children:N(t.subject,b)}),h.jsx("h3",{className:"font-bold text-sm opacity-70 mt-4",children:"Body Preview:"}),s?h.jsx("div",{className:"p-4 bg-white text-black rounded border",dangerouslySetInnerHTML:{__html:N(t.html,b)}}):h.jsx("p",{className:"whitespace-pre-wrap p-4 bg-base-100 rounded",children:N(t.text,b)})]})}),h.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.35},className:"card-actions justify-end gap-2 pt-4",children:[h.jsx(p.button,{type:"button",onClick:a,className:"btn btn-ghost",whileHover:{scale:1.02},whileTap:{scale:.98},children:"Cancel"}),h.jsx(p.button,{type:"submit",className:"btn btn-primary gap-2",disabled:n,whileHover:{scale:1.02},whileTap:{scale:.98},children:n?h.jsxs(h.Fragment,{children:[h.jsx("span",{className:"loading loading-spinner loading-sm"}),"Saving..."]}):h.jsxs(h.Fragment,{children:[h.jsx(T,{className:"w-4 h-4"}),e?"Update Template":"Create Template"]})})]})]})]})})}const S=m.memo(function({template:e,onEdit:a,onDelete:t,index:l}){return h.jsxs(p.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:.05*l},className:"hover:bg-base-200 transition-colors",children:[h.jsx("td",{className:"font-medium",children:e.name}),h.jsx("td",{className:"hidden md:table-cell text-sm opacity-70 max-w-xs truncate",title:e.subject,children:e.subject}),h.jsx("td",{className:"hidden lg:table-cell",children:h.jsx("div",{className:"flex gap-1 flex-wrap",children:e.variables&&e.variables.length>0?e.variables.map(e=>h.jsx("span",{className:"badge badge-sm badge-outline",children:e},e)):h.jsx("span",{className:"text-xs opacity-50",children:"No variables"})})}),h.jsx("td",{className:"hidden sm:table-cell text-sm opacity-70",children:e.created_at&&new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(new Date(e.created_at))}),h.jsx("td",{children:h.jsxs("div",{className:"flex gap-1 sm:gap-2 justify-end",children:[h.jsxs(p.button,{onClick:()=>a(e),className:"btn btn-ghost btn-xs gap-1",whileHover:{scale:1.1},whileTap:{scale:.9},"aria-label":`Edit ${e.name}`,children:[h.jsx(w,{className:"w-3 h-3"}),h.jsx("span",{className:"hidden sm:inline",children:"Edit"})]}),h.jsxs(p.button,{onClick:()=>t(e.id,e.name),className:"btn btn-ghost btn-xs text-error gap-1",whileHover:{scale:1.1},whileTap:{scale:.9},"aria-label":`Delete ${e.name}`,children:[h.jsx(C,{className:"w-3 h-3"}),h.jsx("span",{className:"hidden sm:inline",children:"Delete"})]})]})})]},e.id)});function M(){const[e,a]=m.useState([]),[t,l]=m.useState(!0),[s,i]=m.useState(!1),[n,c]=m.useState(null),r=m.useCallback(()=>o(null,null,function*(){try{l(!0);const e=yield y.getTemplates();a(e.templates)}catch(e){u.error(e instanceof Error?e.message:"Failed to load templates")}finally{l(!1)}}),[]);m.useEffect(()=>{r()},[r]);const d=m.useCallback((e,a)=>o(null,null,function*(){if(confirm(`Are you sure you want to delete the template "${a}"?`))try{yield y.deleteTemplate(e),u.success(`Template "${a}" deleted successfully`),yield r()}catch(t){u.error(t instanceof Error?t.message:"Failed to delete template")}}),[r]),x=m.useCallback(e=>{c(e),i(!0)},[]),f=m.useCallback(()=>{c(null),i(!0)},[]),g=m.useCallback(()=>{i(!1),c(null),r()},[r]);return s?h.jsx(E,{template:n,onClose:g}):h.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card bg-base-100 shadow-xl",children:h.jsxs("div",{className:"card-body",children:[h.jsxs("div",{className:"flex justify-between items-center mb-4",children:[h.jsxs("h2",{className:"card-title flex items-center gap-2",children:[h.jsx(b,{className:"w-6 h-6"}),"Email Templates"]}),h.jsxs(p.button,{onClick:f,className:"btn btn-primary btn-sm gap-2",whileHover:{scale:1.05},whileTap:{scale:.95},"aria-label":"Create new template",children:[h.jsx(k,{className:"w-4 h-4"}),"New Template"]})]}),t?h.jsx(v,{rows:3}):0===e.length?h.jsx(N,{icon:"template",title:"No templates yet",description:"Create your first email template to save time composing similar emails.",action:{label:"Create Template",onClick:f}}):h.jsx("div",{className:"overflow-x-auto",children:h.jsxs("table",{className:"table",children:[h.jsx("thead",{children:h.jsxs("tr",{children:[h.jsx("th",{children:"Name"}),h.jsx("th",{className:"hidden md:table-cell",children:"Subject"}),h.jsx("th",{className:"hidden lg:table-cell",children:"Variables"}),h.jsx("th",{className:"hidden sm:table-cell",children:"Created"}),h.jsx("th",{className:"text-right",children:"Actions"})]})}),h.jsx("tbody",{children:h.jsx(j,{mode:"popLayout",children:e.map((e,a)=>h.jsx(S,{template:e,onEdit:x,onDelete:d,index:a},e.id))})})]})})]})})}export{M as TemplateManager};
